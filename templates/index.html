<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Genius ERP Arquitetura</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="{{ url_for('static', filename='js/project-actions.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/stage-actions.js') }}" defer></script>
</head>
<body>

  <header>
    <h1>Genius ERP Arquitetura</h1>
  </header>

  <section id="novo-projeto">
    <h2>Novo Projeto</h2>
    <form action="{{ url_for('project_bp.criar_projeto') }}" method="POST">
      <input type="text" name="cliente_nome" placeholder="Nome do cliente" required>
      <textarea name="descricao" placeholder="Descrição do projeto"></textarea>
      <select name="tipo" required>
        <option value="residencial">Residencial</option>
        <option value="comercial">Comercial</option>
      </select>
      <input type="text" name="subtipo" placeholder="Subtipo (interiores, planta...)">
      <input type="number" step="0.01" name="valor_hora" placeholder="Valor hora (R$)">
      <button type="submit">Criar Projeto</button>
    </form>
  </section>

  <section id="projetos">
    <h2>Projetos Cadastrados</h2>

    {% for projeto in projetos %}
    <div class="projeto-card">
      <h3>{{ projeto.cliente_nome }}</h3>
      <p>{{ projeto.descricao }}</p>
      <p>Tipo: {{ projeto.tipo }} - Subtipo: {{ projeto.subtipo }}</p>
      <p>Valor/Hora: R$ {{ projeto.valor_hora }}</p>
      <p>Iniciado em: {{ projeto.data_criacao.strftime('%d/%m/%Y') }}</p>

      <!-- Etapas -->
      <div class="etapas">
        <h4>Etapas</h4>
        {% for etapa in projeto.etapas %}
          <div class="etapa">
            <p><strong>{{ etapa.nome }}</strong></p>
            <p>Prazo: {{ etapa.prazo }}</p>
            <p>Tempo trabalhado: {{ etapa.tempo_total_segundos }} segundos</p>

            <form action="{{ url_for('stage_bp.iniciar_etapa', id=etapa.id) }}" method="POST">
              <button type="submit">Iniciar</button>
            </form>

            <form action="{{ url_for('stage_bp.finalizar_etapa', id=etapa.id) }}" method="POST">
              <button type="submit">Finalizar</button>
            </form>
          </div>
        {% else %}
          <p>Sem etapas cadastradas.</p>
        {% endfor %}
      </div>

      <!-- Excluir Projeto -->
      <form action="{{ url_for('project_bp.deletar_projeto', id=projeto.id) }}" method="POST" class="delete-form">
        <button type="submit" onclick="return confirm('Deseja excluir o projeto?')">Excluir Projeto</button>
      </form>
    </div>
    {% else %}
    <p>Nenhum projeto cadastrado.</p>
    {% endfor %}
  </section>

</body>
</html>
